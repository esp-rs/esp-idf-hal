<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Make a copy of a key."><title>psa_copy_key in esp_idf_hal::sys - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="esp_idf_hal" data-themes="" data-resource-suffix="" data-rustdoc-version="1.86.0-nightly (8361aef0d 2025-01-14)" data-channel="nightly" data-search-js="search-75f5ac3e.js" data-settings-js="settings-0f613d39.js" ><script src="../../static.files/storage-59e33391.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../esp_idf_hal/index.html">esp_<wbr>idf_<wbr>hal</a><span class="version">0.45.2</span></h2></div><div class="sidebar-elems"><div id="rustdoc-modnav"><h2><a href="index.html">In esp_<wbr>idf_<wbr>hal::<wbr>sys</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../index.html">esp_idf_hal</a>::<wbr><a href="index.html">sys</a></span><h1>Function <span class="fn">psa_copy_key</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/esp_idf_sys/home/runner/work/esp-idf-hal/esp-idf-hal/target/riscv32imc-esp-espidf/debug/build/esp-idf-sys-7bacc267eb742aef/out/bindings.rs.html#37176-37180">Source</a> </span></div><pre class="rust item-decl"><code>pub unsafe extern &quot;C&quot; fn psa_copy_key(
    source_key: u32,
    attributes: *const <a class="struct" href="struct.psa_key_attributes_s.html" title="struct esp_idf_hal::sys::psa_key_attributes_s">psa_key_attributes_s</a>,
    target_key: *mut u32,
) -&gt; i32</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Make a copy of a key.</p>
<p>Copy key material from one location to another.</p>
<p>This function is primarily useful to copy a key from one location
to another, since it populates a key using the material from
another key which may have a different lifetime.</p>
<p>This function may be used to share a key with a different party,
subject to implementation-defined restrictions on key sharing.</p>
<p>The policy on the source key must have the usage flag
#PSA_KEY_USAGE_COPY set.
This flag is sufficient to permit the copy if the key has the lifetime
#PSA_KEY_LIFETIME_VOLATILE or #PSA_KEY_LIFETIME_PERSISTENT.
Some secure elements do not provide a way to copy a key without
making it extractable from the secure element. If a key is located
in such a secure element, then the key must have both usage flags
#PSA_KEY_USAGE_COPY and #PSA_KEY_USAGE_EXPORT in order to make
a copy of the key outside the secure element.</p>
<p>The resulting key may only be used in a way that conforms to
both the policy of the original key and the policy specified in
the \p attributes parameter:</p>
<ul>
<li>The usage flags on the resulting key are the bitwise-and of the
usage flags on the source policy and the usage flags in \p attributes.</li>
<li>If both allow the same algorithm or wildcard-based
algorithm policy, the resulting key has the same algorithm policy.</li>
<li>If either of the policies allows an algorithm and the other policy
allows a wildcard-based algorithm policy that includes this algorithm,
the resulting key allows the same algorithm.</li>
<li>If the policies do not allow any algorithm in common, this function
fails with the status #PSA_ERROR_INVALID_ARGUMENT.</li>
</ul>
<p>The effect of this function on implementation-defined attributes is
implementation-defined.</p>
<p>\param source_key        The key to copy. It must allow the usage
#PSA_KEY_USAGE_COPY. If a private or secret key is
being copied outside of a secure element it must
also allow #PSA_KEY_USAGE_EXPORT.
\param[in] attributes    The attributes for the new key.
They are used as follows:
- The key type and size may be 0. If either is
nonzero, it must match the corresponding
attribute of the source key.
- The key location (the lifetime and, for
persistent keys, the key identifier) is
used directly.
- The policy constraints (usage flags and
algorithm policy) are combined from
the source key and \p attributes so that
both sets of restrictions apply, as
described in the documentation of this function.
\param[out] target_key   On success, an identifier for the newly created
key. For persistent keys, this is the key
identifier defined in \p attributes.
\c 0 on failure.</p>
<p>\retval #PSA_SUCCESS \emptydescription
\retval #PSA_ERROR_INVALID_HANDLE
\p source_key is invalid.
\retval #PSA_ERROR_ALREADY_EXISTS
This is an attempt to create a persistent key, and there is
already a persistent key with the given identifier.
\retval #PSA_ERROR_INVALID_ARGUMENT
The lifetime or identifier in \p attributes are invalid, or
the policy constraints on the source and specified in
\p attributes are incompatible, or
\p attributes specifies a key type or key size
which does not match the attributes of the source key.
\retval #PSA_ERROR_NOT_PERMITTED
The source key does not have the #PSA_KEY_USAGE_COPY usage flag, or
the source key is not exportable and its lifetime does not
allow copying it to the targetâ€™s lifetime.
\retval #PSA_ERROR_INSUFFICIENT_MEMORY \emptydescription
\retval #PSA_ERROR_INSUFFICIENT_STORAGE \emptydescription
\retval #PSA_ERROR_COMMUNICATION_FAILURE \emptydescription
\retval #PSA_ERROR_HARDWARE_FAILURE \emptydescription
\retval #PSA_ERROR_DATA_INVALID \emptydescription
\retval #PSA_ERROR_DATA_CORRUPT \emptydescription
\retval #PSA_ERROR_STORAGE_FAILURE \emptydescription
\retval #PSA_ERROR_CORRUPTION_DETECTED \emptydescription
\retval #PSA_ERROR_BAD_STATE
The library has not been previously initialized by psa_crypto_init().
It is implementation-dependent whether a failure to initialize
results in this error code.</p>
</div></details></section></div></main></body></html>