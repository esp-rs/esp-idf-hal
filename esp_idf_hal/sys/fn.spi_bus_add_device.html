<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="@brief Allocate a device on a SPI bus"><title>spi_bus_add_device in esp_idf_hal::sys - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="esp_idf_hal" data-themes="" data-resource-suffix="" data-rustdoc-version="1.86.0-nightly (8361aef0d 2025-01-14)" data-channel="nightly" data-search-js="search-75f5ac3e.js" data-settings-js="settings-0f613d39.js" ><script src="../../static.files/storage-59e33391.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../esp_idf_hal/index.html">esp_<wbr>idf_<wbr>hal</a><span class="version">0.45.2</span></h2></div><div class="sidebar-elems"><div id="rustdoc-modnav"><h2><a href="index.html">In esp_<wbr>idf_<wbr>hal::<wbr>sys</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../index.html">esp_idf_hal</a>::<wbr><a href="index.html">sys</a></span><h1>Function <span class="fn">spi_bus_add_device</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/esp_idf_sys/home/runner/work/esp-idf-hal/esp-idf-hal/target/riscv32imc-esp-espidf/debug/build/esp-idf-sys-7bacc267eb742aef/out/bindings.rs.html#29013-29017">Source</a> </span></div><pre class="rust item-decl"><code>pub unsafe extern &quot;C&quot; fn spi_bus_add_device(
    host_id: u32,
    dev_config: *const <a class="struct" href="struct.spi_device_interface_config_t.html" title="struct esp_idf_hal::sys::spi_device_interface_config_t">spi_device_interface_config_t</a>,
    handle: *mut *mut <a class="struct" href="struct.spi_device_t.html" title="struct esp_idf_hal::sys::spi_device_t">spi_device_t</a>,
) -&gt; i32</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>@brief Allocate a device on a SPI bus</p>
<p>This initializes the internal structures for a device, plus allocates a CS pin on the indicated SPI master
peripheral and routes it to the indicated GPIO. All SPI master devices have three CS pins and can thus control
up to three devices.</p>
<p>@note On ESP32, due to the delay of GPIO matrix, the maximum frequency SPI Master can correctly samples the slave’s
output is lower than the case using IOMUX. Typical maximum frequency communicating with an ideal slave
without data output delay: 80MHz (IOMUX pins) and 26MHz (GPIO matrix pins). With the help of extra dummy
cycles in half-duplex mode, the delay can be compensated by setting <code>input_delay_ns</code> in <code>dev_config</code> structure
correctly.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>  There<span class="lifetime">'s </span>no notable delay on chips other than ESP32.</code></pre></div>
<p>@param host_id SPI peripheral to allocate device on
@param dev_config SPI interface protocol config for the device
@param handle Pointer to variable to hold the device handle
@return
- ESP_ERR_INVALID_ARG   if parameter is invalid or configuration combination is not supported (e.g.
<code>dev_config-&gt;post_cb</code> isn’t set while flag <code>SPI_DEVICE_NO_RETURN_RESULT</code> is enabled)
- ESP_ERR_INVALID_STATE if selected clock source is unavailable or spi bus not initialized
- ESP_ERR_NOT_FOUND     if host doesn’t have any free CS slots
- ESP_ERR_NO_MEM        if out of memory
- ESP_OK                on success</p>
</div></details></section></div></main></body></html>