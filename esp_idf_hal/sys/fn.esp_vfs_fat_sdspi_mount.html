<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="@brief Convenience function to get FAT filesystem on SD card registered in VFS"><title>esp_vfs_fat_sdspi_mount in esp_idf_hal::sys - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-46132b98.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="esp_idf_hal" data-themes="" data-resource-suffix="" data-rustdoc-version="1.86.0-nightly (8361aef0d 2025-01-14)" data-channel="nightly" data-search-js="search-75f5ac3e.js" data-settings-js="settings-0f613d39.js" ><script src="../../static.files/storage-59e33391.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-5f194d8c.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../esp_idf_hal/index.html">esp_<wbr>idf_<wbr>hal</a><span class="version">0.45.2</span></h2></div><div class="sidebar-elems"><div id="rustdoc-modnav"><h2><a href="index.html">In esp_<wbr>idf_<wbr>hal::<wbr>sys</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../index.html">esp_idf_hal</a>::<wbr><a href="index.html">sys</a></span><h1>Function <span class="fn">esp_vfs_fat_sdspi_mount</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/esp_idf_sys/home/runner/work/esp-idf-hal/esp-idf-hal/target/riscv32imc-esp-espidf/debug/build/esp-idf-sys-7bacc267eb742aef/out/bindings.rs.html#33164-33170">Source</a> </span></div><pre class="rust item-decl"><code>pub unsafe extern &quot;C&quot; fn esp_vfs_fat_sdspi_mount(
    base_path: *const u8,
    host_config_input: *const <a class="struct" href="struct.sdmmc_host_t.html" title="struct esp_idf_hal::sys::sdmmc_host_t">sdmmc_host_t</a>,
    slot_config: *const <a class="struct" href="struct.sdspi_device_config_t.html" title="struct esp_idf_hal::sys::sdspi_device_config_t">sdspi_device_config_t</a>,
    mount_config: *const <a class="struct" href="struct.esp_vfs_fat_mount_config_t.html" title="struct esp_idf_hal::sys::esp_vfs_fat_mount_config_t">esp_vfs_fat_mount_config_t</a>,
    out_card: *mut *mut <a class="struct" href="struct.sdmmc_card_t.html" title="struct esp_idf_hal::sys::sdmmc_card_t">sdmmc_card_t</a>,
) -&gt; i32</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>@brief Convenience function to get FAT filesystem on SD card registered in VFS</p>
<p>This is an all-in-one function which does the following:</p>
<ul>
<li>initializes an SPI Master device based on the SPI Master driver with configuration in
slot_config, and attach it to an initialized SPI bus.</li>
<li>initializes SD card with configuration in host_config_input</li>
<li>mounts FAT partition on SD card using FATFS library, with configuration in mount_config</li>
<li>registers FATFS library with VFS, with prefix given by base_prefix variable</li>
</ul>
<p>This function is intended to make example code more compact.
For real world applications, developers should implement the logic of
probing SD card, locating and mounting partition, and registering FATFS in VFS,
with proper error checking and handling of exceptional conditions.</p>
<p>@note This function try to attach the new SD SPI device to the bus specified in host_config.
Make sure the SPI bus specified in <code>host_config-&gt;slot</code> have been initialized by
<code>spi_bus_initialize()</code> before.</p>
<p>@param base_path     path where partition should be registered (e.g. “/sdcard”)
@param host_config_input Pointer to structure describing SDMMC host. This structure can be
initialized using SDSPI_HOST_DEFAULT() macro.
@param slot_config   Pointer to structure with slot configuration.
For SPI peripheral, pass a pointer to sdspi_device_config_t
structure initialized using SDSPI_DEVICE_CONFIG_DEFAULT().
@param mount_config  pointer to structure with extra parameters for mounting FATFS
@param[out] out_card If not NULL, pointer to the card information structure will be returned via
this argument. It is suggested to hold this handle and use it to unmount the card later if
needed. Otherwise it’s not suggested to use more than one card at the same time and unmount one
of them in your application.
@return
- ESP_OK on success
- ESP_ERR_INVALID_STATE if esp_vfs_fat_sdmmc_mount was already called
- ESP_ERR_NO_MEM if memory can not be allocated
- ESP_FAIL if partition can not be mounted
- other error codes from SDMMC or SPI drivers, SDMMC protocol, or FATFS drivers</p>
</div></details></section></div></main></body></html>